%global __brp_check_rpaths %{nil}
%global packname  cgraph
%global packver   6.0.1
%global rlibdir   /usr/local/lib/R/library

Name:             R-CRAN-%{packname}
Version:          6.0.1
Release:          3%{?dist}%{?buildtag}
Summary:          Computational Graphs

License:          Apache License 2.0
URL:              https://cran.r-project.org/package=%{packname}
Source0:          %{url}&version=%{packver}#/%{packname}_%{packver}.tar.gz


BuildRequires:    R-devel
Requires:         R-core

%description
Allows to create, evaluate, and differentiate computational graphs in R. A
computational graph is a graph representation of a multivariate function
decomposed by its (elementary) operations. Nodes in the graph represent
arrays while edges represent dependencies among the arrays. An advantage
of expressing a function as a computational graph is that this enables to
differentiate the function by automatic differentiation. The 'cgraph'
package supports various operations including basic arithmetic,
trigonometry operations, and linear algebra operations. It differentiates
computational graphs by reverse automatic differentiation. The flexible
architecture of the package makes it applicable to solve a variety of
problems including local sensitivity analysis, gradient-based
optimization, and machine learning.

%prep
%setup -q -c -n %{packname}

find -type f -executable -exec grep -Iq . {} \; -exec sed -i -e '$a\' {} \;

%build

%install

mkdir -p %{buildroot}%{rlibdir}
%{_bindir}/R CMD INSTALL -l %{buildroot}%{rlibdir} %{packname}

test -d %{packname}/src && (cd %{packname}/src; rm -f *.o *.so)
rm -f %{buildroot}%{rlibdir}/R.css

%files
%dir %{rlibdir}/%{packname}
%doc %{rlibdir}/%{packname}/html
%{rlibdir}/%{packname}/Meta
%{rlibdir}/%{packname}/help
%{rlibdir}/%{packname}/DESCRIPTION
%{rlibdir}/%{packname}/NAMESPACE
%doc %{rlibdir}/%{packname}/NEWS.md
%{rlibdir}/%{packname}/R
%{rlibdir}/%{packname}/INDEX
%{rlibdir}/%{packname}/libs
